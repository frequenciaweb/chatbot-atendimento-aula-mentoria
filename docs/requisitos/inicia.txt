# Requisito de Sistema: 21/06/2025 - Chatbot de Atendimento com MÃºltiplas IAs â€“ Fluxo Conversacional com IdentificaÃ§Ã£o no Chat

## Contexto Geral

O sistema Ã© um chatbot de atendimento inteligente, com integraÃ§Ã£o a mÃºltiplos agentes de IA (ChatGPT, Claude, Modelos Locais via LM Studio). 
Deve permitir que diferentes clientes (UsuÃ¡rios) acessem simultaneamente o sistema web sem compartilhamento de contexto entre eles. 
A interface serÃ¡ feita em Angular 19 e o backend em .NET 8.0 com banco SQLite.
Todo o fluxo serÃ¡ feito de forma conversacional, sem telas intermediÃ¡rias de cadastro.

---



## Requisitos Funcionais (RF)

**RF01. Abertura do Chat**
- O modelo deve estar aberto assim que o cliente acessar a interface.
- Nenhuma tela de cadastro deve ser exibida.
- O cliente poderÃ¡ digitar diretamente uma mensagem inicial (ex: "Oi", "Boa tarde") e o modelo escolhido vai responder a mensagem.
- sempre a interaÃ§Ã£o serÃ¡ feita por um modelo de inteligÃªncia artificial. 

**RF02. IdentificaÃ§Ã£o Conversacional**
- ApÃ³s a primeira mensagem, o modelo deve responder solicitando dois dados: nome completo e telefone celular.
- ele deve ser capaz de identificar esses dois textos durante a conversa com o usuÃ¡rio e sÃ³ prosseguir no fluxo quando 
o usuÃ¡rio confirmar que seu nome e telefone estÃ£o corretos. 
- Esses dados serÃ£o enviados como parte da conversa e tratados via backend.
- O cliente deve responder na mesma janela de chat com nome e telefone.

**RF03. ValidaÃ§Ã£o e Registro do Cliente**
- O sistema deve verificar se o nÃºmero de telefone informado jÃ¡ estÃ¡ registrado.
  - Se estiver, deve buscar o cliente existente e carregadr seu histÃ³rico de mensagens no mÃ¡ximo de 24 horas atrÃ¡s, se nÃ£o entende que Ã© uma nova solicitaÃ§Ã£o.
  - Se nÃ£o estiver, deve criar um novo registro com os dados informados na tabela de clientes.
- O cliente serÃ¡ identificado unicamente pelo telefone celular.

**RF04. ContinuaÃ§Ã£o da Conversa**
- ApÃ³s a identificaÃ§Ã£o, o modelo deve responder com uma saudaÃ§Ã£o personalizada (ex: â€œPerfeito, Paulo! Como posso te ajudar?â€).
- A partir desse ponto, a conversa segue normalmente, com o bot interagindo com base no modelo de IA selecionado.

**RF05. HistÃ³rico de Conversa**
- Toda troca de mensagens (cliente â†” modelo) deve ser salva na tabela `cliente_chats`.
- O histÃ³rico anterior deve ser recuperado e exibido logo apÃ³s a identificaÃ§Ã£o do cliente com maximo de 24 horas.

**RF06. Estrutura de Dados**
- Tabela `clientes`:
  - id
  - nome
  - telefone
  - data_criacao
- Tabela `cliente_chats`:
  - id
  - cliente_id
  - texto
  - origem ("cliente" ou "bot")
  - data_criacao

**RF07. IntegraÃ§Ã£o com MÃºltiplos Modelos de IA**
- O sistema deve suportar troca de agentes de IA durante a conversa.
- O frontend deve permitir a seleÃ§Ã£o de qual IA irÃ¡ responder (ChatGPT, Claude, ou modelos locais).
- coloque tratamento de erro adquado para exibir mensagens de erro 400 vinda do backend. 
- mensagens 500 deve exibir mensagem padrÃ£o "Desculpe, ocorreu um erro ao processar sua mensagem. Tente novamente.".
- Toda mensagem enviada ao backend deve conter:
  - Texto da mensagem
  - Telefone do cliente
  - Nome (apenas se nÃ£o identificado ainda)
  - Modelo de IA selecionado

**RF08. Envio de Mensagem com Contexto**
- A cada nova mensagem, o sistema deve enviar o histÃ³rico da conversa anterior para manter o contexto da IA maximo 24 horas de histÃ³rico.
- Caso o cliente altere a IA durante a conversa, o contexto atual deve ser reaproveitado na nova IA.

**RF09. Listagem de IAs DisponÃ­veis**
- O frontend deve consumir o endpoint  do backend https://localhost:5001/api/Chat/modelos que deve retornar a lista de modelos locais disponÃ­veis em `http://192.168.0.150:1234/v1/models` para listar os modelos locais disponÃ­veis.
{
  "data": [
    {
      "id": "phi-3-mini-4k-instruct",
      "object": "model",
      "owned_by": "organization_owner"
    },
    {
      "id": "deepseek-r1-distill-qwen-1.5b",
      "object": "model",
      "owned_by": "organization_owner"
    },
    {
      "id": "whisper-medium",
      "object": "model",
      "owned_by": "organization_owner"
    },
    {
      "id": "deepseek-r1-distill-qwen-7b",
      "object": "model",
      "owned_by": "organization_owner"
    },
    {
      "id": "gemma-2b",
      "object": "model",
      "owned_by": "organization_owner"
    },
    {
      "id": "mistral-7b-instruct-v0.2",
      "object": "model",
      "owned_by": "organization_owner"
    },
    {
      "id": "text-embedding-nomic-embed-text-v1.5",
      "object": "model",
      "owned_by": "organization_owner"
    }
  ],
  "object": "list"
}
- Caso nÃ£o seja possÃ­vel carregar os modelos vindo do backend nÃ£o deve inserir modelos no frontend. 
- AlÃ©m disso, deve incluir manualmente:
  - ChatGPT: `gpt-4o`, `gpt-4.1`, `o4-mini`, 'gpt-3.5'
  - Claude: `claude-3-sonnet`, `claude-3-haiku`, 'claude-4-sonnet'

---

## Requisitos NÃ£o Funcionais (RN)

**RN01. Conversa 100% no Chat**
- Nenhuma etapa do processo deve exigir o preenchimento de formulÃ¡rio fora da interface de chat.
- A coleta de dados e validaÃ§Ã£o serÃ¡ feita apenas via diÃ¡logo com o modelo.

**RN02. CÃ³digo Simples e Direto**
- A API serÃ¡ implementada de forma direta, com aÃ§Ãµes no controller e uso de DTOs, sem separaÃ§Ã£o por camadas.

**RN03. SessÃµes Separadas**
- O sistema deve garantir que cada cliente tenha sua prÃ³pria sessÃ£o e que os contextos nÃ£o se misturem.

**RN04. Armazenamento Local**
- Toda a persistÃªncia serÃ¡ feita em banco SQLite local.

**RN05. Pronto para ProduÃ§Ã£o**
- O sistema deverÃ¡ permitir build e execuÃ§Ã£o sem erros em ambiente local para desenvolvimento e testes.

**RN06. Instale Swagger**
- o bacekend deve ter o Swagger instalado para documentar os endpoints do controller.

---


## Tarefas TÃ©cnicas ObrigatÃ³rias de InicializaÃ§Ã£o do Projeto

âš ï¸ As tarefas a seguir devem ser executadas obrigatoriamente antes de qualquer implementaÃ§Ã£o de funcionalidade.  
âš ï¸ NÃ£o podem ser ignoradas, puladas, alteradas ou descartadas por nenhum motivo.  
âš ï¸ SÃ£o etapas mÃ­nimas exigidas para inicializar corretamente o projeto e organizar os arquivos conforme a estrutura definida.  

### ğŸ”§ CriaÃ§Ã£o do Projeto Angular
- Criar o projeto base Angular com o seguinte comando:
  - `ng new src-web`
- Gerar o componente da pÃ¡gina principal de chat:
  - `ng g c pages/chat`
- Gerar o serviÃ§o responsÃ¡vel pela integraÃ§Ã£o com a API:
  - `ng g s services/chat`

### ğŸ”§ CriaÃ§Ã£o do Projeto .NET (API)
- Criar o projeto base da Web API com o seguinte comando:
  - `dotnet new webapi -n src-api --use-controllers`
- Criar o arquivo `.gitignore` do backend:
  - `dotnet new gitignore`
- Criar o arquivo `.soluction` do backend:
  - `dotnet sln ChatBot.sln`  
  -  add src-api/src-api.csproj

Essas etapas sÃ£o mandatÃ³rias e devem ser executadas integralmente antes da codificaÃ§Ã£o de qualquer controller, DTO, model ou componente Angular.

---


#OrganizaÃ§Ã£o
- Crie o cÃ³digo dentro das pasta src e documente tudo na pasta docs/execucao enumernado cada interaÃ§Ã£o. 

## Estrutura do Projeto

src/
 â”œâ”€â”€ README.md                               âœ… DocumentaÃ§Ã£o geral do projeto
 â”œâ”€â”€ src-api/                                âœ… Projeto Backend (.NET Core 8 + SQLite)
 â”‚   â”œâ”€â”€ .gitignore                          âœ… Ignora arquivos desnecessÃ¡rios no versionamento do backend
 â”‚   â””â”€â”€ NomeProjeto.src/                    âœ… Projeto principal da API
 â”‚       â”œâ”€â”€ Controllers/                    âœ… Controllers da API (aÃ§Ãµes diretas, sem camadas)
 â”‚       â”œâ”€â”€ Models/                         âœ… Modelos de entidades (Cliente, ClienteChat)
 â”‚       â”œâ”€â”€ DTOs/                           âœ… Objetos de transferÃªncia de dados
 â”‚       â”œâ”€â”€ appsettings.json                âœ… ConfiguraÃ§Ãµes de IAs e banco
 â”‚       â””â”€â”€ Program.cs                      âœ… ConfiguraÃ§Ã£o e inicializaÃ§Ã£o do projeto
 â”‚
 â”œâ”€â”€ src-web/                                âœ… Projeto Frontend (Angular 19)
 â”‚   â”œâ”€â”€ .gitignore                          âœ… Ignora arquivos desnecessÃ¡rios no versionamento do frontend
 â”‚   â”œâ”€â”€ package.json                        âœ… ConfiguraÃ§Ãµes de dependÃªncias e scripts
 â”‚   â””â”€â”€ src/app/
 â”‚       â”œâ”€â”€ pages/
 â”‚       â”‚   â””â”€â”€ chat-atendimento/           âœ… PÃ¡gina principal do chat (nÃ£o hÃ¡ incluir/editar/cadastro)
 â”‚       â”‚       â””â”€â”€ conversar/              âœ… Tela principal do chat e controle da sessÃ£o
 â”‚       â”œâ”€â”€ models/                         âœ… Interfaces dos DTOs (cliente, mensagem, resposta)
 â”‚       â”œâ”€â”€ components/                     âœ… Componentes reutilizÃ¡veis (ex: chat-box, combo IA)
 â”‚       â”œâ”€â”€ services/                       âœ… ServiÃ§os Angular para integraÃ§Ã£o com API
 â”‚       â”œâ”€â”€ interceptors/                   âœ… Interceptadores HTTP (ex: autenticaÃ§Ã£o futura, loaders)
 â”‚       â”œâ”€â”€ util/                           âœ… FunÃ§Ãµes auxiliares e helpers
 â”‚       â””â”€â”€ environments/                   âœ… Arquivos de configuraÃ§Ã£o de ambiente
 â”‚
 â””â”€â”€ docs/                                   âœ… DocumentaÃ§Ã£o tÃ©cnica
     â”œâ”€â”€ requisitos/                         âœ… Arquivos com RF e RN organizados por funcionalidade
     â”œâ”€â”€ diagramas/                          âœ… Diagramas de arquitetura e fluxos
     â””â”€â”€ testes/                             âœ… Casos de teste e evidÃªncias de validaÃ§Ã£o

---

## ObservaÃ§Ãµes Finais

- Nenhum fluxo externo ao chat deve existir para identificaÃ§Ã£o ou cadastro.
- Todo o processo Ã© feito exclusivamente via troca de mensagens com o bot.
- O telefone celular Ã© a Ãºnica chave usada para identificar e recuperar a sessÃ£o do cliente.
